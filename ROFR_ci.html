<!DOCTYPE html>
<html>
	<head>
		<title>電視影集授權談判</title>
		<meta charset="utf-8">	
		<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/t/bs/jq-2.2.0,dt-1.10.11/datatables.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" type="text/javascript"></script>
	</head>

	<body>
		<div class="container">
			<div id ="start">

			<h1>電視影集授權談判</h1><br /><br />
			<p>時間回到2001年1月，由Paramount影視公司製作的《歡樂一家親》(FRASIER) 情境喜劇<br />，已在NBC電視台連續播出8年，即將邁入第9季。因為Paramount與NBC的合約到期，<br />雙方正要開始進行續約的議價協商。<br /><br />此時的《歡樂一家親》影集已是最受美國觀眾喜愛的電視節目，曾創下多項收視記錄<br />，也在8年的時間裡拿下過多達24項的「黃金時段艾美獎」(Primetime Emmy Award)。<br />帶著輝煌的成績，Paramount在續約過程中要求極為高昂的節目播映授權費，並威脅說<br />CBS電視台也願意出高價來搶《歡樂一家親》的播映權。<br /><br />不過，Paramount和NBC先前已就續約的「談判流程」達成共識，他們會依照雙方講定<br />的遊戲規則來議價。基本上，Paramount必須先與NBC一對一議價，只有在雙方正式破<br />局的情況下，Paramount才能開始與其他電視台談《歡樂一家親》的播映授權。不只如<br />此，如果最後Paramount同意與其他任何電視台簽約，而授權費卻低過NBC先前的出價<br />金額，那麼NBC可以享有「優先權」(right of first refusal)，也就是說，只要NBC願意接<br />受Paramount與其他電視台所談成的合約，Paramount協商就必須與NBC簽約。<br /><br />在這個遊戲裡，將請你扮演Paramount的角色，並以Paramount能獲得最大利益的目標<br />來議價。<br /><br /><b>角色介紹</b><br />Paramount：製作公司，在續約協商的過程中極力爭取天價的播映授權費<br />NBC：期待成功續約，對新合約擁有「優先權」（由電腦扮演）<br />CBS：期待有機會從NBC手中搶下新一季的播映權（由電腦扮演）</p>
			<br /><p><b>遊戲規則</b> 1<br />NBC的播映權即將到期，如果可以成功續約，新一季的《歡樂一家親》可以為NBC帶來<br />1000萬美金的廣告收入。<br />Paramount和NBC已同意採用以下流程來協商新合約，共分三個階段。<br /><br /><p><b>第一階段：NBC出價</b><br />Paramount與NBC先互派代表會面討論，然後由NBC決定出價金額並填寫提議書。<br />Paramount在收到提議書之後，可選擇「簽字同意」或「拒絕」。如果Paramount簽字<br />同意，則雙方成交，遊戲結束。如果Paramount拒絕NBC的出價，則協商進入「第二階<br />段」&hellip;&hellip;<br /><br /><p><b>第二階段：CBS出價</b><br />Paramount已拒絕了NBC的出價，在這個階段要開始和CBS議價。<br />Paramount與CBS將先互派代表會面討論，然後CBS可以選擇「棄權」或「出價」。CBS<br />若棄權，則遊戲結束，最後沒有任何電視台取得播映權；CBS若決定出價，就填寫提議<br />書交給Paramount。<br /><br />根據評估，新一季的《歡樂一家親》也可以為CBS帶來1000萬美金的廣告收入。不過，<br />在出價的過程中，CBS需要額外支付顧問與法律費用共計20萬美金。請注意，無論最後<br />協商結果如何，CBS只要有出價，就必須要支付這些「協商成本」。<br />Paramount在收到提議書之後，可以選擇「簽字同意」或是「拒絕」。如果Paramount<br />拒絕CBS的出價，則雙方協商破局，遊戲結束，最後沒有任何電視台取得播映權。如果<br />Paramount簽字同意，而且CBS的出價不低於NBC在第一階段的出價，則雙方成交，遊<br />戲結束，最新一季的《歡樂一家親》將改由CBS播出。如果Paramount簽字同意，但<br />CBS的出價低過NBC在第一階段的出價，那麼協商程序就進到第三階段&hellip;&hellip;</p>
			<p>1 這裡的遊戲規則是大幅簡化與改寫後的版本；若你好奇當年 Paramount與NBC真實的協商規則，可以<br />參考附錄提供的歷史資料。</p>
			<p><br /><p><b>第三階段：NBC行使「優先權」</b><br />NBC享有「優先權」，因此可以選擇是否要「簽字接受」Paramount和CBS先前談成的<br />合約。如果NBC簽字接受，則Paramount與NBC成交。如果NBC拒絕接受，則Paramount<br />與CBS成交。</p>
			<p>Paramount的利潤完全來自於授權費。簽約取得播映權的電視台會有1000萬美金的收入<br />，但同時需要支付授權費。此外，CBS只要出價，就必須支付20萬美金的協商成本。</p>
			<p><br /><p><b>變種規則──當NBC不再享有「優先權」</b><br />假設在續約協商的過程中，NBC不再享有「優先權」。新的協商流程會是這樣：<br />第一階段：照舊。<br />第二階段：大致照舊，唯一的修正是，只要Paramount簽字同意CBS的出價，雙方便成<br />交，遊戲結束。<br />最後，在這個版本的遊戲規則裡，沒有第三階段。</p>

				<button class='btn btn-primary' id="get_start">閱讀完畢，準備開始</button>
			</div>
			<div class="row" id = "game">
				<div id = ROFR_1 class="col">
					<h2>
						情境一 - NBC擁有優先權
					</h2>
					
					<p id="NBC_price"></p>
					
					<button class='btn btn-primary NBC_Bu' id='NBC_accept'> 接受</button>
					<button class='btn btn-primary NBC_Bu' id='NBC_reject'> 拒絕</button>
					
					<p id="CBS_price"></p>
					
					<button class='btn btn-primary CBS_Bu' id='CBS_accept'> 接受</button>
					<button class='btn btn-primary CBS_Bu' id='CBS_reject'> 拒絕</button>
					
					<p id ="result"></p>
				</div>
				
				<div id = ROFR_2 class="col">
					<h2>
						情境二 - NBC沒有優先權。
					</h2>
					
					<p id="NBC_price_2"></p>
					
					<button class='btn btn-primary NBC_Bu_2' id='NBC_accept_2'> 接受</button>
					<button class='btn btn-primary NBC_Bu_2' id='NBC_reject_2'> 拒絕</button>
					
					<p id="CBS_price_2"></p>
					
					<button class='btn btn-primary CBS_Bu_2' id='CBS_accept_2'> 接受</button>
					<button class='btn btn-primary CBS_Bu_2' id='CBS_reject_2'> 拒絕</button>
					
					<button class='btn btn-primary' id='reset'>再玩一次</button>
					<p id ="result_2"></p>
					
				</div>
			</div>
		</div>		
	</body>
	
	<script>


		$( "#get_start" ).click(function() {
				$("#game").css("display","flex");
				$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
				$.cookie('ifstart', true);
			});
		function getRandom()
		{
		  var num = Math.random();
		  if(num < 0.5) return false;  
		  else return true;
		}

		var record ={};
		var min, max;
		if (getRandom()){

			min = 750;
			max = 800;
		}
		else{
			min = 800;
			max = 970;
		}

		// and the formula is:
		
		var NBC_price = Math.floor(Math.random() * (max - min + 1)) + min;
		var CBS_price, NBC_price_2, CBS_price_2;
		$(document).ready(function() {
			first_round();
		});
		function first_round()
		{
			record['NBC_price_1'] = NBC_price;
			$( "#NBC_price" ).append( "第一階段：NBC出價 "+NBC_price+"萬美金。<br/>此階段你可以選擇接受或拒絕");
			
			$( "#NBC_accept" ).click(function() {
				record['round_1_step_1'] = 1;
				$( "#ROFR_1" ).append( "<br/>交易成立，賺了 <div class='price'>"+NBC_price+" </div>萬元。此情境結束，進入情境二。");
				disable();
				second_round();
			});
			
			$( "#NBC_reject" ).click(function() {
				record['round_1_step_1'] = 0;
				disable();				
				// and the formula is:
				var max_2 = 980

				var dif = Math.floor(Math.random() * (50 - 10 + 1)) + 10;
				//CBS_price = NBC_price - dif;
				CBS_price = Math.floor(Math.random() * (980 - NBC_price + 1)) + NBC_price;
				record['CBS_price_1'] = CBS_price;
				$( ".CBS_Bu" ).css("display", " inline-block");
				$( ".CBS_Bu" ).prop('disabled', false);
				$( "#CBS_price" ).append( "第二階段：CBS出價"+CBS_price+"萬美金。<br/>此階段你可以選擇接受或拒絕");
				$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
				
			});
			
			$( "#CBS_accept" ).click(function() {
				record['round_1_step_2'] = 1;
				disable();
				if(CBS_price>NBC_price)
				{
					$( "#result" ).append( "恭喜！你與CBS的合約成立，賺了 <div class='price'>"+CBS_price+" 萬元。");
				}
				else
				{
					$( "#result" ).append( "進入第三階段，NBC決定以 "+CBS_price+" 萬元與你成交！");
				}
				second_round();
			});
			
			
			$( "#CBS_reject" ).click(function() {
				record['round_1_step_2'] = 0;
				disable();
				$( "#result" ).append( "談判破裂，你沒有達成任何協議，賺了 <div class='price'>0 </div> 元。");
				second_round()
			});
		}
		
		function disable(){
			$(':input').prop('disabled', true);
			$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
			//$('#NBC_reject').prop('disabled', true);
		}
		
		function second_round()
		{
			$( "#result" ).append( "</br> <button class='btn btn-primary' id='next'>進入情境二</button>");
			$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
			$( "#next" ).click(function() {
				alert("準備好了嗎? 準備進入情境二");
				sec();
			});


		}
		function sec(){
			$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
			$("#ROFR_1").append("<hr>");
			var max_2 = 2;
			var min_2 = 100;
			NBC_price_2 = Math.floor(Math.random() * (max_2 - min_2 + 1)) + min_2;
			
			record['NBC_price_2'] = NBC_price_2;
			$( "#ROFR_2" ).css("display", "block");
			$( "#NBC_price_2" ).append( "第一階段：NBC出價"+NBC_price_2+"萬美金。<br/>此階段你可以選擇接受或拒絕");
			
			$( ".CBS_Bu_2" ).css("display", "none");
			$( ".NBC_Bu_2" ).prop('disabled', false);
			
			$( "#NBC_accept_2" ).click(function() {
				record['round_2_step_1'] = 1;
				$( "#result_2" ).append( "<br/>交易成立，賺了 <div class='price'>"+NBC_price_2+"</div> 萬元。");
				disable();
				record_result();
			});
			
			$( "#NBC_reject_2" ).click(function() {
				record['round_2_step_1'] = 0;
				disable();
				
				// and the formula is:
				var min_2_2 = 1
				var max_2_2 = NBC_price_2
				CBS_price_2 = Math.floor(Math.random() * (max_2_2 - min_2_2 + 1)) + min_2_2;
				record['CBS_price_2'] = CBS_price_2;
				$( ".CBS_Bu_2" ).css("display", " inline-block");
				$( ".CBS_Bu_2" ).prop('disabled', 0);
				$( "#CBS_price_2" ).append( "第二階段：CBS出價"+CBS_price_2+"萬美金。<br/>此階段你可以選擇接受或拒絕");
			});
			
			$( "#CBS_accept_2" ).click(function() {
				record['round_2_step_2'] = 1;
				disable();
				$( "#result_2" ).append( "恭喜！你與CBS的合約成立，賺了 <div class='price'>"+CBS_price_2+"</div> 萬元。");
				record_result();
			});
			$( "#CBS_reject_2" ).click(function() {
				record['round_2_step_2'] = 0;
				disable();
				$( "#result_2" ).append( "談判破裂，你什麼都沒賺到！發現優先權其實不一定是壞事了嗎？");
				record_result();
			});
		}

		$( "#reset" ).click(function() {
			location.reload();
		});
		
		// if (window.performance) {
		//   console.info("window.performance work's fine on this browser");
		// }
		if (performance.navigation.type == 1) {
		    console.info( "This page is reloaded" );
		    if ($.cookie('ifstart')=='true'){
		    	$( "#get_start" ).trigger( "click" );
		    }		    
		} else {
		    console.info( "This page is not reloaded");
		    $.cookie('ifstart', false);
		}

		function record_result()
		{
			$('#reset').css('display','inline-block')
			$('#reset').prop('disabled', false);
			$( "#result_2" ).append( "<hr>");
			$("html, body").animate({ scrollTop: $(document).height()-$(window).height() });
				
			console.log(record);

			console.log("after parse");

			var form_data = new FormData();

			for ( var key in record ) {
			    form_data.append(String(key), record[key]);
			}
			jQuery(document).ajaxSend(function(event, xhr, settings) {
			    function getCookie(name) {
			        var cookieValue = null;
			        if (document.cookie && document.cookie != '') {
			            var cookies = document.cookie.split(';');
			            for (var i = 0; i < cookies.length; i++) {
			                var cookie = jQuery.trim(cookies[i]);
			                // Does this cookie string begin with the name we want?
			                if (cookie.substring(0, name.length + 1) == (name + '=')) {
			                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			                    break;
			                }
			            }
			        }
			        return cookieValue;
			    }
			    function sameOrigin(url) {
			        // url could be relative or scheme relative or absolute
			        var host = document.location.host; // host + port
			        var protocol = document.location.protocol;
			        var sr_origin = '//' + host;
			        var origin = protocol + sr_origin;
			        // Allow absolute or scheme relative URLs to same origin
			        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
			            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
			            // or any other URL that isn't scheme relative or absolute i.e relative.
			            !(/^(\/\/|http:|https:).*/.test(url));
			    }
			    function safeMethod(method) {
			        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			    }
			 
			    if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
			        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
			    }
			});
			console.log("ajax")
			$.ajax({
			    url         : 'http://140.112.107.55:8000/api/ROFR/',
			    data        : form_data,
			    processData : false,
			    contentType : false,
			    type: 'POST'
			}).done(function(data){
			    console.log("add success")
			});
			
		}
	</script>
	<style>
		.CBS_Bu, #ROFR_2, .CBS_Bu_2{
			display:none;
		}
		.container{
			margin-top:5%;
		}
		#game{
			display:none;
			height:300px;
			width: 75%;
  			margin: 0 auto;
		}
		#start{
			width: 75%;
  			margin: 0 auto;
  			padding-left: 8%;
		}
		#ROFR_1{
			padding-left:0;
		}
		.price{
			color:red;
			display: inline;
		}
		#reset{
			display:none;
		}
		#result_2{
			margin-bottom: 100px;
		}
    </style>
</html>

